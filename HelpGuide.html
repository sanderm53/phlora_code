<html>
<head>
<style>
body
{
font-size:20px;
font-family:helvetica;
color:white;
}
</style>
</head>


<body>
<br>
<p style="font-size:30px;"><b><i>Phlora</i> Help</b></p>

<p>Phlora is designed to display phylogenetic trees showing the evolutionary relationships of species. A tree presented in Phlora has a "root" on the left side of the screen, which is the most recent common ancestor of all of the "leaves" on the right side, which represent species or other taxonomic entities. Optionally, groups of leaves can be given names to form a higher level "classification" scheme. Such groups can be displayed as yellow rounded boxes around parts of the tree.</p>

<p>In Phlora each leaf of the tree can also be associated with an image provided by the user. The image can be zoomed and moved as
the tree pans or "frozen" in place.</p>

<p><b>Quick overview of the studies included in the Phlora app distribution</b></p>
<p>The app comes with several studies and a small sample of images "built-in". To get a sense of image diversity on a sizable phylogenetic tree, look at the "Cactaceae" study first, which includes a sample of 35 images of various species of cacti. Click the "info" page on the bottom of the tree view page for that study for more details about the study and its images. A second study, for the plant genus Viburnum, shows images of leaves from three of its 152 species. Over a hundred additional images can be downloaded from our database via the "Download" page. Finally, the "Legumes of Arizona" study includes three images from its tree of the over 300 species of legume plants found in Arizona. These images are taken from preserved herbarium specimens from the University of Arizona herbarium. Over 200 additional images can be downloaded from our database. Note that these downloads can occupy quite a bit of storage on your device. Several additional studies are included that have no images provided by us -- feel free to add your own (see below).</p>


<p><b>Navigating the Phlora interface</b></p>

<p>The "Studies" button on the main page presents a table view summarizing the data currently available for display in the app. Each study includes a single tree, optional images, and an optional classification scheme. Tapping a study presents the tree view for that study.</p>

<p>The tree view displays the phylogenetic tree and labels for all leaves of the tree. The tree can be zoomed and panned with the usual pinch and swipe gestures. A gray dot next to a leaf indicates that an image file is present on the device. A single tap on the dot will display the image and the dot will turn yellow. Pinch and swipe gestures on the image act as expected to move and zoom the image. Double tapping an image will zoom in by a factor of 2x. Normally, the image pans with the tree as the tree is panned. To "freeze" the image in place, triple-tap on the image. To unfreeze it, triple-tap again. Tap on the yellow dot to close the image. The dot will turn blue to remind you that you have seen this image during this session.</p>

<p>The navigation bar at the top has two icons at upper right. The '+' icon is for adding your own images (see below). The search icon will open a search window allowing you to search for names of leaves in the tree. As you type a query in the search box, the tree view will light up leaves that match this query (matching any text within the leaf name in a case-insensitive way). A red dot will appear next to matching leaf labels. </p>

<p>The toolbar at the bottom of the screen has an information button, which may contain background information about the study. Optionally, the toolbar may also display other buttons. If images are present for the study a white-outline square button is present. This can be used to toggle currently open images on screen on or off all at once. There may also be a yellow-outline rounded button. If present, tapping this button will display a classification scheme for the tree, consisting of yellow "bubbles" around parts of the tree (see below under 'Classification schemes' for more).</p>


<p><b>Downloading data from the Phlora remote database</b></p>

<p>The app includes some large trees with just a small number of images. You can download a larger collection of images from the Phlora remote database by clicking on 'Download' from the main page. Then simply click the 'Download' button for whatever study you are interested in. You can continue using Phlora or other apps while the download continues, but do not 'kill' the app by swiping up from the bottom of the screen.</p>

<p><b>Importing your own data</b></p>

<p>You can add your own images to existing studies, or add a new study consisting of its tree and possibly images and an information file. There are two general approaches. The simpler one is to interactively add files using '+' icons in the app. This is fine for a single tree file and a few images. The more general approach is to create a set of files having trees, images, and text and copy these over to your device to the appropriate destinations using tools such as the 'Files' app, iCloud Drive, or AirDrop.</p>

<p><i>Adding images one at a time to a tree already in the app.</i> On the tree view click the "+" in the upper right, which will then display "+" by each leaf label. Click on one of these to bring up a dialog to allow importing of an image for that leaf. Images can be imported from the device's Photo Library or from a file found on the device or in iCloud Drive. If you choose to import from the device Photo Library, please note that you have to explicitly allow this. The first time this is attempted the app should present an alert that asks permission to import from your Library. The app does nothing with your images other than present them on screen within Phlora, and make a copy in the Phlora Documents directory on the device (for more about Phlora's privacy policy, please see http://phlora.org/WebSite/PrivacyPolicy.html). You can also set this permission under iOS 'Settings'. Select the settings for 'Phlora' and then set the 'Photos' permissions to allow Phlora to access your photos. Once you have added an image it will be included the next time you launch Phlora.</p>

<p><i>Adding a new tree to Phlora.</i> To add a new tree you must create a tree file, which is a special text file described below. Once done, on the "Studies" page click the "+" button, which will launch a view that will let you pick the tree file from either iCloud Drive or some folder on your device where you have placed the file. If the file is correctly formatted a new entry will appear in the table and you may then view the tree. If an error message is displayed you will have to return to edit the tree file and correct any format problems.</p>

<p><i>Preparing the tree file.</i> On your desktop/laptop prepare a plain text file with a '.txt' file extension, in what I will call a "near-Nexus" format (based on the long-standing standard Nexus format used in phylogenetic biology). Some iOS apps can create plain text files on your device, but I find it easier to work on this file elsewhere. Below is an example of a simple near-Nexus file:</p>
	<p><ul style="list-style: none;">
	<li>tree Cats = (house_cat,(lion, tiger));
	<li>reference = 'I made this tree up';
	<li>mrca roaring_cats = lion, tiger;
	</ul></p>
	
<p>Only the first line is required. This is a tree description and has a study/treename ('Cats') and a description of the tree proper (to the right of the parens, up to the semi-colon). The study/tree name is used interchangably throughout Phlora for the name of the study and tree because each study is only permitted to have one tree. The second line is optional and presents information about the source of the tree information. Place all text between single quotes. Finally the third line is used for the optional classification scheme. It is a so-called node-based definition of a group name ('roaring_cats'). There can be more than one 'mrca' line. See below under 'Classification scheme' for more details.</p>

<p>Use only simple leaf labels consisting of alphanumeric characters and underscores, such as 'house_cat' above. Do not use white space within the labels. The parser in the app is still primitive.</p>

<p>It is a good idea to test your tree description line in some other tree visualization software (e.g., FigTree) before attempting an import into Phlora. Once you have verified that the file has a proper tree description, move it to your iCloud Drive folder or move it to your device directly (e.g., using AirDrop).</p>


<p><i>Adding entire new studies, or many images at once.</i> To add a new study with perhaps many images, it is easiest to create a collection of files and folders on your laptop/desktop and then copy them to the right place on your device. To set this up, it is necessary to understand how Phlora stores the data files on the device.</p>

<p>All files must be placed in a particular hierarchy of folders and subfolders. At the highest level in the Phlora app's sandbox directory is a folder called 'Studies'. Within that is a folder that is named with the specific study/tree name. Within each specific study folder are up to three subfolders, named 'Tree', 'Images', and 'Text'. Thus, for the Cats example above there would be a folder called 'Cats' within 'Studies', and 'Cats' contains the subfolders, 'Tree', 'Images' and 'Text'.</p>


<p>Create this hierarchy of folders on your laptop/desktop. Then, copy a properly formatted tree file (see above) to the 'Tree' folder in your study's folder. Then, if you have images, copy properly named image files to the 'Images' folder. For the tree above, for example, the following names are examples of what might be expected as file names:</p>

	<p><ul style="list-style: none;">
	<li>house_cat.jpg
	<li>lion.png
	<li>tiger.jpeg
	</ul></p>
	
<p>where each name corresponds exactly to the spelling of that leaf label in the tree file, but with an extension indicating the type of image format. These labels are case sensitive.</p>
<p>Then, (optionally) create a plain text file with any background in it about the study, give it the name Study/treename.txt based on your actual study name, and place it in the 'Text' folder.</p>
<p>Once this hierarchy of folders is set up, copy it to the device and place it within Phlora's 'Studies' folder. Again, this can be done by moving it from laptop/desktop to iCloud Drive first and then using the device's 'Files' app to move it your device, or you may be able to use Air Drop or some other transfer. Once on your device, you can browse the directory/folders/file hierarchy using the 'Files' app, available in iOS 11 and up.</p>

<p><i>Deleting images, trees, or entire studies.</i> Images can be deleted by pressing and holding for 1 second an open image and then responding to the alert with 'Delete'. This deletes only the local copy of the image stored in the Phlora directory, not your original copy. However, this will not delete any images that came built in to the Phlora app. Currently the only option is to replace such an image manually by adding an image with the same name to the 'Images' folder as described above. Phlora will prefer this user added image to the built-in image and display it instead.</p>
<p>Deleting an entire study is done from the Study table view by pressing the "Edit" button and then deleting the study table entry. <i>This will delete all files associated with this study from your device, including all image files!</i> It will not affect files on iCloud drive or outside of the Phlora folder on your device. Files can also be deleted via the device 'Files' utility from outside of Phlora. Built-in studies cannot be deleted, but they can be "overridden" by adding files and folders with appropriate names as described here.</p>

<p><i>Adding a "title" image for a new study, to appear on the left side of the Study table view.</i> Simply tap on the "Add image" pane in the Study table to choose an image to represent the new study. This can also be done manually by putting a file named something like 'Study/treename.jpeg', where the base of the filename is the same name used in the tree description to name the tree/study, into the Images folder for this study.</p>


<p><b>Classification schemes</b></p>

<p>A little background information is helpful if you want to add a classification scheme for your phylogenetic tree (see, for example, the Wikipedia entry on 'Phylogenetic Nomenclature' and numerous references cited therein). The following is a quick start set of instructions. First, a bit of terminology: a <i>clade</i> is a subtree consisting of an ancestor and all of its descendants, including a set of leaf species. Phlora can display phylogenetic classifications in which selected clades are given names. You can see an example of a classification in both the 'Cactaceae' and 'Viburnum' studies by clicking on the yellow button at the bottom of the tree view. Clades in your tree can be given names by writing formal definitions into the tree file. The format for a so-called 'node-based' definition of a clade can be seen in this example:</p>
	<p><ul style="list-style: none;">
	<li>mrca roaring_cats = lion, tiger;
	</ul></p>

<p>The label 'roaring_cats' will be assigned to the clade that comprises the most recent common ancestor of lion and tiger and all of its descendants. Only two leaf labels ('specifiers') to the right of the '=' sign are allowed.</p>

<p>The syntax for a 'stem-based' definition is:</p>
	<p><ul style="list-style: none;">
	<li>mrca roaring_cats = lion ~ house_cat;
	</ul></p>
<p>which refers to the clade comprising all leaves more closely related to lion than to house_cat. The order of the specifiers on the right of the '=' is important, and only two specifiers are allowed.</p>

<p><b><i>Important: please read!</i>  Images and Device Memory </b></p>
<p>Phlora can use large amounts of device RAM when numerous images are open at the same time. Most relatively recent iOS mobile devices have 1-4 GB RAM and you might wish to check to see how much yours has. In general I have had few problems with devices having 2 GB or more RAM, but occasional problems arise with very large images (meaning >10MB JPEGs) on older devices having only 1 GB RAM, such as my iPhone 5c. In general you should experience few problems on older devices if images are kept to ~ 1-3 MB in size.</p>

<p>Irrespective of how much RAM is present, when images are much larger than this or very numerous, the app benefits from some active memory management. When an image first becomes visible on screen it is displayed at "low resolution". When it is zoomed by roughly enough to fill an iPad screen, it switches to the full high resolution version of the image. However, <i>when a high resolution image that has been zoomed-in scrolls off the screen, it returns to low resolution. Tap it after it scrolls back into view to restore its sharpness.</i></p>

 <p>If memory runs low, the program will close images that are open in the current tree and all other trees that may still be open on currently hidden tree views. A closed image has its image icon presented in blue to indicate that the user has viewed it at least once. It may also be worth manually closing some currently visible images to improve performance. If all else fails the program will quit unceremoniously. Attempting to display a 15 MB JPEG, which might require a RAM buffer of 400 MB when uncompressed, can easily kill the app on devices with only 1 GB of RAM. </p>
</body>
</html>

<html>
<head>
<style>
body
{
font-size:20px;
font-family:helvetica;
color:white;

}
</style>
</head>


<body>
<br>
<p style="font-size:30px;"><b><i>Phlora</i> Help</b></p>

<p>Phlora is designed to display phylogenetic trees showing the evolutionary relationships of species. A tree presented in Phlora has a "root" on the left side of the screen, which is the most recent common ancestor of all of the "leaves" on the right side, which represent species or other taxonomic entities. Optionally, collections of leaves can be given names to form a higher level "classification" scheme. Such group names are shown as yellow rounded boxes around parts of the tree.</p>

<p>In Phlora each leaf of the tree can also be annotated with an image provided by the user. The image can be zoomed and moved as
the tree pans or "frozen" in place.</p>


<p><b>Navigating the Phlora interface</b></p>

<p>The "Studies" button on the main page presents a table view summarizing the data currently available for display in the app. Each study includes a single tree, optional images, and an optional classification scheme. Tapping a study presents the tree view for that study.</p>

<p>The tree view displays the phylogenetic tree and labels for all leaves of the tree. The tree can be zoomed and panned with the usual pinch and swipe gestures. A gray dot next to a leaf indicates that an image file is present on the device. A single tap on the dot will display the image and the dot will turn yellow. Pinch and swipe gestures on the image act as expected to move and zoom the image. Double tapping an image will zoom in by a factor of 2x. Normally, the image pans with the tree as the tree is panned. To "freeze" the image in place, triple-tap on the image. To unfreeze it, triple-tap again. Tap on the yellow dot to close the image. The dot will turn blue to remind you that you have seen this image during this session.</p>

<p>The navigation bar at the top has two icons at upper right. The '+' icon is for adding your own images (see below). The search icon will open a search window allowing you to search for names of leaves in the tree. As you type a query in the search box, the tree view will light up leaves that match this query (matching from the beginning of the query string to the beginning of the leaf name; i.e., query to prefix). A red dot will appear next to matching leaf labels. </p>

<p>The toolbar at the bottom of the screen has an information button, which may contain background information on the study. This screen is editable so users can add their own information. Just hit the "Save" button when finished. Optionally, the toolbar may also display other buttons. If images are present for the study a white-outline square button is present. This can be used to toggle currently open images on screen on or off all at once. There may also be a yellow-outline rounded button. If present, tapping this button will display a higher level classification scheme for the tree (see below for more background).</p>


<p><b>Importing data from our remote database</b></p>

<p>The app includes some large studies having just a small number of images to avoid distributing an app with a large memory footprint. You can download the remaining images from our remote database by clicking on "Remote DB' from the main page. Then simply click the 'Download' button for whatever study you are interested in. The download may be several gigabytes and is run in the background on the device. You can continue using Phlora or other apps while the download continues, but do not 'kill' the app by swiping up from the bottom of the screen, for example. The download may take a while, and it may be helpful to leave the device attached to its power cable.</p>

<p><b>Importing your own data</b></p>

<p>You can add your own images to existing studies, or add a new study consisting of its tree and possibly images and an information file. There are two general approaches. The simpler one is to interactively add files using '+' icons in the app. This is fine for a single tree file and a few images. The more general approach is to create a set of files having trees, images, and text and copy these over to your device to the appropriate destinations using tools such as the 'Files' app, iCloud Drive, or Airdrop.</p>

<p><i>Adding images one at a time to a tree already in the app.</i> On the tree view click the "+" in the upper right, which will then display "+" by each leaf label. Click on one of these to bring up a dialog to allow importing of an image for that leaf. Images can be imported from the device's Photo Library or from a file found on the device or in iCloud Drive. If you choose to import from the device Photo Library please note that you have to explicitly allow this. The first time this is attempted the app should present an alert that asks permission to import from your Library. The app does nothing with your images other than present them on screen within Phlora, and make a copy in the Phlora Documents directory on the device. You can also set this permission under iOS 'Settings'. Select the settings for 'Phlora' and then set the 'Photos' permissions to allow Phlora to access your photos. Once you have added an image it will be included the next time you launch Phlora.</p>

<p><i>Adding a new tree to Phlora.</i> To add a new tree you must create a tree file, which is a special text file described below. Once done, on the "Studies" page click the "+" button, which will launch a view that will let you pick the tree file from either iCloud Drive or some folder on your device where you have placed the file. If the file is correctly formatted a new entry will appear in the table and you may then view the tree. If an error message is displayed you will have to return to edit the tree file and correct any format problems.</p>

<p><i>Preparing the tree file.</i> On your desktop/laptop prepare a plain text file with a '.txt' file extension, in what I will call a "near-nexus" format (based on a long-standing standard format in the phylogenetic biology literature). Some iOS apps exist to create plain text files on your device, but I find it easier to work on this file elsewhere. Below is an example of a simple file:</p>
	<p><ul style="list-style: none;">
	<li>tree Cats = (house_cat,(lion, tiger));
	<li>reference = 'I made this tree up';
	<li>mrca roaring_cats = lion, tiger;
	</ul></p>
	
<p>Only the first line is required. This is a tree description and has a study/tree name (Cats) and a description of the tree proper (to the right of the parens, up to the semi-colon). The study/tree name is used interchangably throught Phlora for the name of the study and tree because each study is only permitted to have one tree. The second line is optional and presents information about the source of the tree. Place all text between single quotes. Finally the third line is a so-called node-based definition of a group name (roaring_cats) for the optional classification scheme. There can be more than one mrca line. See below under 'Classification scheme' for more details.</p>

<p>Use only simple leaf labels consisting of alphanumeric characters and underscores, such as 'house_cat' above. Do not use white space within the labels. The parser in the app is still primitive.</p>

<p>It is worth testing your tree description line in some other tree visualization software before attempting an import into Phlora. Once you are sure of the file, move it to your iCloud Drive folder or move it to your device directly.</p>


<p><i>Adding entire new studies, or many images at once.</i> To undertake adding a new study with perhaps many images, it is necessary to understand how Phlora stores the data files on the device. Then your task is simply to copy the relevant files to the right place. </p>

<p>All files must be placed in a particular hierarchy of folders and subfolders. At the highest level in the Phlora app's sandbox directory is a folder called 'Studies'. Within that is a folder that is named with the study/tree name. Within each specific study folder are up to three subfolders, named 'Tree', 'Images', and 'Text'. In the Cats example there is a folder called 'Cats' within 'Studies', and it contains subfolders, 'Tree', 'Images' and 'Text'.</p>


<p>First, you will need to copy a properly formatted tree file (see above) to the 'Tree' folder in your study's folder. To add images, copy a properly named set of image files to the 'Images' folder. So, for the tree above, for example, the following names are examples of what are expected:</p>

	<p><ul style="list-style: none;">
	<li>house_cat.jpg
	<li>lion.png
	<li>tiger.jpeg
	</ul></p>
	
<p>where each name corresponds exactly to the spelling of that leaf label in the tree file, but with an extension indicating the type of image format. These labels are case sensitive..</p>

<p>You can browse the directory/folders/file hierarchy of your device with the 'Files' app, which comes with iOS 11+ by default.</p>

<p><i>Adding a "title" image for a new study, to appear on the left side of the Study table view.</i> Simply tap on the "Add image" pane in the Study table to choose an image to represent the new study. This can also be done manually by putting a file named something like 'tree/studyname.jpeg', where the base of the filename is the same name used in the tree description to name the tree/study, into the Images folder for this study.</p>

<p><i>Adding a "Info" file for a new study</i> If you do not wish to edit this interactively after open the tree information screen of your study, you can prepare a plain text file (no markup of any kind) with the name 'StudyName.txt'. This must be placed in the Study folder in a subfolder called, 'Text'.</p>

<p><i>Deleting images, trees, or entire studies.</i>Images can be deleted by pressing and holding for 1 second on an open image and then responding to the alert with 'Delete'. This deletes only the local copy of the image stored in the Phlora directory, not your original copy. Deleting an entire study is done from the Study table view by pressing the "Edit" button and then deleting the study table entry. <i>This will delete all files associated with this study from your device, including all image files!</i> It will not affect files on iCloud drive or outside of the Phlora folder on your device. Obviously, images can also be deleted via the device Files utility from outside of Phlora </p>

<p><b>Classification schemes</b></p>

<p>A little background information is helpful if you want to add a classification scheme for your phylogenetic tree. The following is a quick start set of instructions. Group names can be applied to clades in your tree by writing 'mrca' statements into the tree file. The format for a 'node-based' definition of a clade is</p>
	<p><ul style="list-style: none;">
	<li>mrca roaring_cats = lion, tiger;
	</ul></p>

<p>In this line 'mrca' stands for 'most recent common ancestor'; the label 'roaring_cats' will be assigned to the clade that comprises the most recent common ancestor of lion and tiger and all of its descendants. Only two specifiers to the right of the '=' sign can be included.</p>

<p>The syntax for a stem-based definition is slightly unconventional relative to the literature. For example</p>
	<p><ul style="list-style: none;">
	<li>mrca roaring_cats = lion ~ house_cat;
	</ul></p>

<p>is the "clade comprising all leaves more closely related to lion than to house_cat". The order of the specifiers on the right of the '=' is important, and only two specifiers can be given.</p>

<p><b><i>Important!</i> -- Memory considerations </b></p>
<p>Phlora can use large amounts of device RAM when numerous images are open at the same time. There should be few problems if
 images are kept to ~ 1 MB in size, but when images are much larger than this (as in high resolution herbarium specimen images, for example), memory requires some active management. When an image first becomes visible it is displayed at "low resolution". When it is zoomed by roughly enough to fill an iPad screen, it switches to the full high resolution version of the image. Note, <i>when a high resolution image that has been zoomed-in scrolls off the screen, it returns to low resolution. Tap it after it scrolls back in view to restore its sharpness.</i></p>
 
 <p>If memory runs low, the program will close
 images that are open in other trees than the one currently displayed, as well as images in the current tree that are off screen at the moment.
 A closed image has its image icon presented in blue to indicate that the user has viewed it at least once. It may also be worth manually
 closing some currently visible images to improve performance. If all else fails the program will quit unceremoniously.</p>
</body>
</html>
